# æµå¼ç¼–ç¨‹

ç¬”è®°æ¥æºäº[On Java 8](https://lingcoder.gitee.io/onjava8/#/book/14-Streams"On Java 8")~~

æµæ˜¯ä¸€ç³»åˆ—ä¸ç‰¹å®šå­˜å‚¨æœºåˆ¶æ— å…³çš„å…ƒç´ --å®é™…ä¸Šï¼Œæµæ²¡æœ‰"å­˜å‚¨"ä¸€è¯´ã€‚

æµå¯ä»¥åœ¨ä¸ä½¿ç”¨èµ‹å€¼æˆ–å¯å˜æ•°æ®çš„æƒ…å†µä¸‹å¯¹æœ‰çŠ¶æ€çš„ç³»ç»Ÿå»ºæ¨¡ã€‚

å°±åƒå£°æ˜å¼ç¼–ç¨‹ï¼ˆDeclarative programmingï¼‰ï¼šå£°æ˜è¦åšä»€ä¹ˆï¼Œè€Œä¸æ˜¯æ€ä¹ˆåšçš„ç¼–ç¨‹é£æ ¼ã€‚
æ‰€è§å³æ‰€åšã€‚

Exampleï¼š

```Java
// streams/Randoms.java
import java.util.*;
public class Randoms {
    public static void main(String[] args) {
        new Random(47)//ç§å­æ•°
            .ints(5, 20)//é™å®šæ•°å€¼äº§ç”Ÿçš„è¾¹ç•Œï¼ˆä¹‹åç”Ÿæˆæ•´æ•°æµ
            .distinct()//è·å–éé‡å¤å€¼
            .limit(7)//è·å–å‰ä¸ƒä¸ªå…ƒç´ 
            .sorted()
            .forEach(System.out::println);//ä½¿ç”¨foreachæ–¹æ³•éå†è¾“å‡ºï¼ˆæ–¹æ³•å¼•ç”¨
    }
}

```

è¾“å‡ºç»“æœ

```python
6
10
13
16
17
18
19
```

è¿™æ®µç¤ºä¾‹ä¸­æ²¡æœ‰å£°æ˜ä»»ä½•å˜é‡ï¼Œç›¸æ¯”äºä¼ ç»Ÿç¼–ç æ–¹å¼æ›´ç®€æ´ã€‚

## æµæ”¯æŒ

å°†æµæ¦‚å¿µèå…¥åˆ°ç°æœ‰ç±»åº“ä¸­ã€‚


é—®é¢˜ï¼š
æ¥å£éƒ¨åˆ†æ€ä¹ˆæ”¹é€ å‘¢ï¼Ÿç‰¹åˆ«æ˜¯æ¶‰åŠé›†åˆç±»æ¥å£çš„éƒ¨åˆ†ã€‚å¦‚æœä½ æƒ³æŠŠä¸€ä¸ªé›†åˆè½¬æ¢ä¸ºæµï¼Œç›´æ¥å‘æ¥å£æ·»åŠ æ–°æ–¹æ³•ä¼šç ´åæ‰€æœ‰è€çš„æ¥å£å®ç°ç±»ã€‚

è§£å†³ï¼š
åœ¨æ¥å£ä¸­æ·»åŠ è¢« `default`ï¼ˆ`é»˜è®¤`ï¼‰ä¿®é¥°çš„æ–¹æ³•ã€‚é€šè¿‡è¿™ç§æ–¹æ¡ˆï¼Œè®¾è®¡è€…ä»¬å¯ä»¥å°†æµå¼ï¼ˆ*stream*ï¼‰æ–¹æ³•å¹³æ»‘åœ°åµŒå…¥åˆ°ç°æœ‰ç±»ä¸­ã€‚æµæ–¹æ³•é¢„ç½®çš„æ“ä½œå‡ ä¹å·²æ»¡è¶³äº†æˆ‘ä»¬å¹³å¸¸æ‰€æœ‰çš„éœ€æ±‚ã€‚æµæ“ä½œçš„ç±»å‹æœ‰ä¸‰ç§ï¼šåˆ›å»ºæµï¼Œä¿®æ”¹æµå…ƒç´ ï¼ˆä¸­é—´æ“ä½œï¼Œ Intermediate Operationsï¼‰ï¼Œæ¶ˆè´¹æµå…ƒç´ ï¼ˆç»ˆç«¯æ“ä½œï¼Œ Terminal Operationsï¼‰ã€‚æœ€åä¸€ç§ç±»å‹é€šå¸¸æ„å‘³ç€æ”¶é›†æµå…ƒç´ ï¼ˆé€šå¸¸æ˜¯åˆ°é›†åˆä¸­ï¼‰ã€‚



## æµåˆ›å»º

å¯ä»¥é€šè¿‡ `Stream.of()` å¾ˆå®¹æ˜“åœ°å°†ä¸€ç»„å…ƒç´ è½¬åŒ–æˆä¸ºæµ

```Java
// streams/StreamOf.java
import java.util.stream.*;
public class StreamOf {
    public static void main(String[] args) {
        Stream.of(new Bubble(1), new Bubble(2), new Bubble(3))
            .forEach(System.out::println);
        Stream.of("It's ", "a ", "wonderful ", "day ", "for ", "pie!")
            .forEach(System.out::print);
        System.out.println();
        Stream.of(3.14159, 2.718, 1.618)
            .forEach(System.out::println);
    }
}

```

è¾“å‡ºï¼š

```
Bubble(1)
Bubble(2)
Bubble(3)
It's a wonderful day for pie!
3.14159
2.718
1.618

```



è¿˜å¯ä»¥é€šè¿‡è®©é›†åˆè°ƒç”¨`stream()`æ–¹æ³•æ¥äº§ç”Ÿä¸€ä¸ªæµã€‚

```Java
// streams/CollectionToStream.java
import java.util.*;
import java.util.stream.*;
public class CollectionToStream {
    public static void main(String[] args) {
        List<Bubble> bubbles = Arrays.asList(new Bubble(1), new Bubble(2), new Bubble(3));
        System.out.println(bubbles.stream()
            .mapToInt(b -> b.i)
            .sum());

        Set<String> w = new HashSet<>(Arrays.asList("It's a wonderful day for pie!".split(" ")));
        w.stream()
         .map(x -> x + " ")
         .forEach(System.out::print);
        System.out.println();

        Map<String, Double> m = new HashMap<>();
        m.put("pi", 3.14159);
        m.put("e", 2.718);
        m.put("phi", 1.618);
        m.entrySet().stream()
                    .map(e -> e.getKey() + ": " + e.getValue())
                    .forEach(System.out::println);
    }
}

```

è¾“å‡ºï¼š

```
6
a pie! It's for wonderful day
phi: 1.618
e: 2.718
pi: 3.14159

```

### éšæœºæ•°æµ

```java
// streams/RandomGenerators.java
import java.util.*;
import java.util.stream.*;
public class RandomGenerators {
    public static <T> void show(Stream<T> stream) {
        stream
        .limit(4)
        .forEach(System.out::println);
        System.out.println("++++++++");
    }

    public static void main(String[] args) {
        Random rand = new Random(47);
        show(rand.ints().boxed());
        
        show(rand.longs(50, 100).boxed());// æ§åˆ¶ä¸Šé™å’Œä¸‹é™ï¼š
        
        show(rand.doubles(2).boxed());// æ§åˆ¶æµå¤§å°ï¼š
        
        show(rand.doubles(3, 11.5, 12.3).boxed());// æ§åˆ¶æµçš„å¤§å°å’Œç•Œé™
    }
}

```

æ³›å‹æ–¹æ³• `show(Stream<T> stream)`ï¼Œå³æ¥æ”¶ä»»ä½•ç±»å‹çš„æµå…ƒç´ ï¼ˆè£…ç®±ç±»å‹ï¼‰
ç„¶è€Œrandomåªèƒ½ç”ŸæˆåŸºæœ¬ç±»å‹intã€longã€double
æ‰€ä»¥ä½¿ç”¨`boxed()`æµæ“ä½œå°†åŸºæœ¬ç±»å‹åŒ…è£…æˆä¸ºå¯¹åº”çš„è£…ç®±ç±»å‹

è¾“å‡ºï¼š

```Java
-1172028779
1717241110
-2014573909
229403722
++++++++
85
78
71
76
++++++++
0.2613610344283964
0.0508673570556899
++++++++
12.142972435968321
12.109653264924663
11.924343683208141
++++++++

```





## ä¸­é—´æ“ä½œ

ä¸­é—´æ“ä½œç”¨äºä»ä¸€ä¸ªæµä¸­è·å–å¯¹è±¡ï¼Œå¹¶å°†å¯¹è±¡ä½œä¸ºå¦ä¸€ä¸ªæµä»åç«¯è¾“å‡ºï¼Œä»¥è¿æ¥åˆ°å…¶ä»–æ“ä½œã€‚

### è·Ÿè¸ªå’Œè°ƒè¯•

```java
// streams/Peeking.java
class Peeking {
    public static void main(String[] args) throws Exception {
        FileToWords.stream("Cheese.dat")
        .skip(21)//æ ¹æ®å‚æ•°ä¸¢å¼ƒæŒ‡å®šæ•°é‡çš„æµå…ƒç´ ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¸¢å¼ƒäº†å‰ 21 ä¸ªå…ƒç´ ã€‚
        .limit(4)//è·å–å‰å››ä¸ª
        .map(w -> w + " ")
        .peek(System.out::print)
        .map(String::toUpperCase)
        .peek(System.out::print)
        .map(String::toLowerCase)
        .forEach(System.out::print);
    }
}
```

è¾“å‡ºï¼š

```
Well WELL well it IT it s S s so SO so
```

peekå°±åƒä¸€ä¸ªé¥æ§é±¼ğŸŸï¼Œåªèƒ½è§‚æµ‹å½“å‰æµåŸŸçš„æ•°æ®ï¼Œä½†ä¸èƒ½è¯¥ä¿®æ”¹æµä¸­å…ƒç´ 
èµ·åˆ°è·Ÿè¸ªçš„ä½œç”¨ï¼Œåœ¨è°ƒè¯•ä»£ç æ—¶å¯ä»¥ç”¨åˆ°ã€‚